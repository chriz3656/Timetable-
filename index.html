<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4a6fa5">
    <meta name="description" content="Interactive college timetable for CSE Department">
    <title>College Timetable</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="/icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="/icons/icon-512x512.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6b8cae;
            --text-color: #333;
            --light-text: #f5f5f5;
            --bg-color: #f9f9f9;
            --card-bg: #ffffff;
            --break-color: #ffeb99;
            --lunch-color: #ffcc80;
            --class-color: #c8e6c9;
            --lab-color: #bbdefb;
            --workshop-color: #d1c4e9;
            --sports-color: #c8e6c9;
            --current-class: #81c784;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
            --transition: all 0.3s ease;
            --neon-glow: 0 0 10px rgba(74, 111, 165, 0.5);
        }
        [data-theme="dark"] {
            --primary-color: #5e81ac;
            --secondary-color: #81a1c1;
            --text-color: #eceff4;
            --light-text: #e5e9f0;
            --bg-color: #2e3440;
            --card-bg: #3b4252;
            --break-color: #5e81ac;
            --lunch-color: #d08770;
            --class-color: #a3be8c;
            --lab-color: #5e81ac;
            --workshop-color: #b48ead;
            --sports-color: #8fbcbb;
            --current-class: #8fbcbb;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --neon-glow: 0 0 10px rgba(94, 129, 172, 0.7);
        }
        [data-theme="ocean"] {
            --primary-color: #0077be;
            --secondary-color: #00a8cc;
            --text-color: #2d3436;
            --light-text: #ffffff;
            --bg-color: #e0f7fa;
            --card-bg: #ffffff;
            --break-color: #80deea;
            --lunch-color: #4dd0e1;
            --class-color: #81d4fa;
            --lab-color: #4fc3f7;
            --workshop-color: #29b6f6;
            --sports-color: #039be5;
            --current-class: #0288d1;
            --shadow: 0 4px 15px rgba(0, 119, 190, 0.2);
            --neon-glow: 0 0 15px rgba(2, 136, 209, 0.4);
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-color) 0%, var(--card-bg) 100%);
            color: var(--text-color);
            line-height: 1.6;
            transition: var(--transition);
            padding: 20px;
            position: relative;
            min-height: 100vh;
            padding-bottom: 80px;
            overflow-x: hidden;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            animation: fadeIn 0.8s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
            animation: slideInDown 0.8s ease-out;
        }
        @keyframes slideInDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .college-info {
            max-width: 600px;
            perspective: 1000px;
        }
        .college-name {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 5px;
            font-weight: 700;
            text-shadow: var(--neon-glow);
            transform-style: preserve-3d;
            transition: transform 0.3s;
        }
        .college-name:hover {
            transform: translateZ(20px);
        }
        .dept-info {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--secondary-color);
            font-size: 1.1rem;
        }
        .batch-info {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 10px;
            background: rgba(0,0,0,0.05);
            padding: 8px 12px;
            border-radius: var(--border-radius);
            backdrop-filter: blur(5px);
        }
        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        .search-container {
            position: relative;
            flex-grow: 1;
            min-width: 200px;
            transform: translateZ(0);
        }
        #search {
            width: 100%;
            padding: 12px 15px;
            border-radius: 30px;
            border: 2px solid transparent;
            background-color: var(--card-bg);
            color: var(--text-color);
            transition: var(--transition);
            box-shadow: var(--shadow);
        }
        #search:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 111, 165, 0.3);
        }
        .day-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 5px;
            scrollbar-width: thin;
        }
        .day-tab {
            padding: 12px 25px;
            background-color: var(--card-bg);
            border-radius: 30px;
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            font-weight: 500;
            box-shadow: var(--shadow);
            transform: translateZ(0);
            position: relative;
            overflow: hidden;
        }
        .day-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        .day-tab:hover::before {
            left: 100%;
        }
        .day-tab:hover {
            background-color: var(--secondary-color);
            color: var(--light-text);
            transform: translateY(-3px);
        }
        .day-tab.active {
            background-color: var(--primary-color);
            color: var(--light-text);
            box-shadow: var(--neon-glow);
            transform: translateY(-3px);
        }
        .timetable-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            margin-bottom: 20px;
            perspective: 1000px;
        }
        .timetable-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--light-text);
            padding: 15px;
            text-align: center;
            border-radius: var(--border-radius);
            font-weight: bold;
            box-shadow: var(--shadow);
            transform-style: preserve-3d;
            transition: transform 0.3s;
        }
        .timetable-header:hover {
            transform: translateZ(10px);
        }
        .time-slot {
            padding: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
            background-color: var(--card-bg);
            display: flex;
            flex-direction: column;
            transform-style: preserve-3d;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
        }
        .time-slot::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s;
        }
        .time-slot:hover::after {
            transform: translateX(100%);
        }
        .time-slot:hover {
            transform: translateY(-5px) rotateY(5deg);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        .time-slot.break {
            background: linear-gradient(135deg, var(--break-color), #ffd54f);
        }
        .time-slot.lunch {
            background: linear-gradient(135deg, var(--lunch-color), #ffb74d);
        }
        .time-slot.lecture {
            background: linear-gradient(135deg, var(--class-color), #a5d6a7);
        }
        .time-slot.lab {
            background: linear-gradient(135deg, var(--lab-color), #90caf9);
        }
        .time-slot.workshop {
            background: linear-gradient(135deg, var(--workshop-color), #ce93d8);
        }
        .time-slot.sports {
            background: linear-gradient(135deg, var(--sports-color), #80cbc4);
        }
        .time-slot.current {
            background: linear-gradient(135deg, var(--current-class), #4db6ac);
            position: relative;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
        }
        .time-slot.current::after {
            content: "NOW";
            position: absolute;
            top: -10px;
            right: -10px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .time-label {
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--primary-color);
            font-size: 0.9em;
            text-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }
        .course-code {
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        .course-name {
            font-weight: 500;
            margin: 5px 0;
            font-size: 0.95em;
        }
        .faculty-info {
            font-size: 0.85em;
            opacity: 0.8;
            margin-top: auto;
        }
        .credit-hours {
            font-size: 0.8em;
            margin-top: 3px;
            opacity: 0.7;
        }
        .mobile-day-view {
            display: none;
        }
        .day-content {
            display: grid;
            gap: 15px;
        }
        .nav-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
        }
        button {
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--light-text);
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }
        button::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s;
        }
        button:hover::after {
            transform: translateX(100%);
        }
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .theme-toggle {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
        }
        .theme-toggle:hover {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--light-text);
        }
        /* --- New Student Button Styles --- */
        #students-btn {
            text-decoration: none;
            display: flex; /* Make the link behave like a block for the button */
        }
        #students-btn button {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            color: var(--light-text);
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            font-weight: 500;
            position: relative;
            overflow: hidden;
            padding: 10px 15px; /* Adjust padding to match other buttons */
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0; /* Remove default margin from button if any */
        }
        #students-btn button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        #students-btn button::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s;
        }
        #students-btn button:hover::after {
            transform: translateX(100%);
        }
        /* --- End Student Button Styles --- */

        /* --- New Admin Button Styles --- */
        #admin-login-btn {
            text-decoration: none;
            display: flex; /* Make the link behave like a block for the button */
        }
        #admin-login-btn button {
            background: linear-gradient(135deg, #8e44ad, #9b59b6); /* Purple gradient */
            color: var(--light-text);
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            font-weight: 500;
            position: relative;
            overflow: hidden;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0;
        }
        #admin-login-btn button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        #admin-login-btn button::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s;
        }
        #admin-login-btn button:hover::after {
            transform: translateX(100%);
        }
        /* --- End Admin Button Styles --- */


        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease-out;
        }
        .modal-content {
            background: linear-gradient(135deg, var(--card-bg), rgba(255,255,255,0.9));
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            position: relative;
            transform: scale(0.9);
            animation: modalAppear 0.4s forwards;
            border: 1px solid rgba(0,0,0,0.1);
        }
        @keyframes modalAppear {
            to { transform: scale(1); }
        }
        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-color);
            transition: var(--transition);
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        .close-modal:hover {
            background: rgba(0,0,0,0.1);
            transform: rotate(90deg);
        }
        .modal-title {
            margin-bottom: 20px;
            color: var(--primary-color);
            text-align: center;
            font-size: 1.5rem;
            text-shadow: var(--neon-glow);
        }
        .modal-info {
            margin-bottom: 15px;
            display: flex;
            padding: 12px;
            background: rgba(0,0,0,0.03);
            border-radius: var(--border-radius);
            transition: var(--transition);
        }
        .modal-info:hover {
            background: rgba(0,0,0,0.05);
            transform: translateX(5px);
        }
        .modal-label {
            font-weight: bold;
            min-width: 130px;
            color: var(--primary-color);
        }
        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            padding: 30px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        .footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            text-align: center;
            background: linear-gradient(135deg, var(--card-bg), rgba(255,255,255,0.9));
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.05);
        }
        .credit {
            font-size: 0.9em;
            opacity: 0.8;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .social-links {
            display: flex;
            gap: 20px;
            margin-top: 5px;
            justify-content: center;
        }
        .social-link {
            color: var(--text-color);
            opacity: 0.7;
            transition: var(--transition);
            font-size: 1.4em;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(0,0,0,0.05);
        }
        .social-link:hover {
            opacity: 1;
            transform: translateY(-5px) scale(1.1);
            background: var(--primary-color);
            color: white;
            box-shadow: var(--neon-glow);
        }
        @media (max-width: 1024px) {
            .timetable-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        @media (max-width: 768px) {
            .timetable-grid {
                display: none;
            }
            .mobile-day-view {
                display: block;
            }
            .day-tabs {
                justify-content: center;
            }
            header {
                flex-direction: column;
            }
            .college-info {
                text-align: center;
            }
            .footer {
                position: relative;
                margin-top: 30px;
            }
        }
        @media (max-width: 480px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            .day-tabs {
                flex-wrap: wrap;
                justify-content: center;
            }
            .nav-buttons {
                justify-content: center;
            }
            .credit {
                flex-direction: column;
                gap: 0;
            }
        }
        /* PWA Install Prompt */
        #installContainer {
            position: fixed;
            bottom: 1em;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--card-bg), rgba(255,255,255,0.9));
            padding: 1.5em;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 999;
            display: none;
            animation: slideUp 0.5s ease-out;
            border: 1px solid rgba(0,0,0,0.1);
        }
        @keyframes slideUp {
            from { transform: translate(-50%, 100%); }
            to { transform: translate(-50%, 0); }
        }
        #installButton {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 0.8em 1.5em;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 500;
            box-shadow: var(--shadow);
        }
        #installContainer.hidden {
            display: none !important;
        }
        /* Theme selector */
        .theme-selector {
            position: relative;
        }
        .theme-options {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            display: none;
            flex-direction: column;
            z-index: 100;
            overflow: hidden;
            margin-top: 5px;
        }
        .theme-selector:hover .theme-options {
            display: flex;
        }
        .theme-option {
            padding: 10px 20px;
            cursor: pointer;
            transition: var(--transition);
        }
        .theme-option:hover {
            background: var(--primary-color);
            color: var(--light-text);
        }
        .theme-option[data-theme="light"] { background: linear-gradient(to right, #f9f9f9, #e0e0e0); }
        .theme-option[data-theme="dark"] { background: linear-gradient(to right, #2e3440, #3b4252); color: white; }
        .theme-option[data-theme="ocean"] { background: linear-gradient(to right, #e0f7fa, #b2ebf2); }
        /* Notification Button */
        #notify-btn {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            color: var(--light-text);
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            font-weight: 500;
            position: relative;
            overflow: hidden;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        #notify-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        #notify-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s;
        }
        #notify-btn:hover::after {
            transform: translateX(100%);
        }
        #notify-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        /* Share Button */
        #share-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--light-text);
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
            font-weight: 500;
            position: relative;
            overflow: hidden;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        #share-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        #share-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transform: translateX(-100%);
            transition: transform 0.5s;
        }
        #share-btn:hover::after {
            transform: translateX(100%);
        }
        #share-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        /* --- Loading Screen Styles --- */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }
        .loader {
            border: 8px solid rgba(255, 255, 255, 0.3);
            border-top: 8px solid var(--light-text);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #loading-text {
            color: var(--light-text);
            font-size: 1.2rem;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loader"></div>
        <div id="loading-text">Loading Timetable...</div>
    </div>
    <div class="container">
        <header>
            <div class="college-info">
                <div class="college-name">COLLEGE OF ENGINEERING ARANMULA</div>
                <div class="dept-info">Department of Computer Science and Engineering</div>
                <div class="batch-info">Batch: 2025-2026 (Diploma - CFIS) | Semester: S1 | Tutor: Sherin Annie Thomas</div>
            </div>
            <div class="controls">
                <!-- Admin Login Button Added Here -->
                <a href="./adminpage/admin_login.html" id="admin-login-btn" title="Admin Login">
                    <button>
                        <i class="fas fa-user-shield"></i> Admin Login
                    </button>
                </a>
                <!-- End Admin Login Button -->
                <div class="search-container">
                    <input type="text" id="search" placeholder="Search courses, faculty...">
                </div>
                <button id="today-btn">Today</button>
                <a href="./students.html" id="students-btn" title="View Student List">
                    <button>
                        <i class="fas fa-users"></i> View All Students
                    </button>
                </a>
                <button id="share-btn" title="Share Timetable">
                    <i class="fas fa-share-alt"></i> Share
                </button>
                <button id="notify-btn" title="Enable Notifications">
                    <i class="fas fa-bell"></i> Notify
                </button>
                <div class="theme-selector">
                    <button class="theme-toggle" id="theme-toggle">
                        <span id="theme-icon">ðŸŒ™</span> Theme
                    </button>
                    <div class="theme-options">
                        <div class="theme-option" data-theme="light">Light</div>
                        <div class="theme-option" data-theme="dark">Dark</div>
                        <div class="theme-option" data-theme="ocean">Ocean</div>
                    </div>
                </div>
            </div>
        </header>
        <div class="nav-buttons">
            <button id="prev-day">Previous Day</button>
            <button id="next-day">Next Day</button>
        </div>
        <div class="day-tabs" id="day-tabs">
            <!-- Tabs will be generated by JavaScript -->
        </div>
        <div class="timetable-grid" id="timetable-grid">
            <!-- Grid header -->
            <div class="timetable-header">Time</div>
            <div class="timetable-header">Monday</div>
            <div class="timetable-header">Tuesday</div>
            <div class="timetable-header">Wednesday</div>
            <div class="timetable-header">Thursday</div>
            <div class="timetable-header">Friday</div>
            <!-- Time slots will be populated by JavaScript -->
        </div>
        <div class="mobile-day-view" id="mobile-day-view">
            <!-- Mobile day view will be populated by JavaScript -->
        </div>
        <div class="modal" id="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3 class="modal-title" id="modal-title">Course Details</h3>
                <div class="modal-info">
                    <span class="modal-label">Time:</span>
                    <span id="modal-time"></span>
                </div>
                <div class="modal-info">
                    <span class="modal-label">Day:</span>
                    <span id="modal-day"></span>
                </div>
                <div class="modal-info">
                    <span class="modal-label">Course Code:</span>
                    <span id="modal-code"></span>
                </div>
                <div class="modal-info">
                    <span class="modal-label">Course Name:</span>
                    <span id="modal-subject"></span>
                </div>
                <div class="modal-info">
                    <span class="modal-label">Faculty:</span>
                    <span id="modal-teacher"></span>
                </div>
                <div class="modal-info">
                    <span class="modal-label">Type:</span>
                    <span id="modal-type"></span>
                </div>
                <div class="modal-info">
                    <span class="modal-label">Credits:</span>
                    <span id="modal-credits"></span>
                </div>
                <div class="modal-info">
                    <span class="modal-label">Hours/Week:</span>
                    <span id="modal-hours"></span>
                </div>
                <div class="modal-info">
                    <span class="modal-label">Department:</span>
                    <span id="modal-dept"></span>
                </div>
            </div>
        </div>
    </div>
    <div id="installContainer" class="hidden">
        <p>Install this app for better experience</p>
        <button id="installButton">Install</button>
        <button id="dismissInstallButton">Dismiss</button>
    </div>
    <div class="footer">
        <div class="credit">
            <span>Created by</span>
            <span style="font-weight:bold;color:var(--primary-color)">chriz</span>
        </div>
        <div class="social-links">
            <a href="https://chriz3656.github.io" target="_blank" class="social-link" title="Website">
                <i class="fas fa-globe"></i>
            </a>
            <a href="https://instagram.com/chriz__3656" target="_blank" class="social-link" title="Instagram">
                <i class="fab fa-instagram"></i>
            </a>
            <a href="https://discord.com/users/chriz__3656" target="_blank" class="social-link" title="Discord">
                <i class="fab fa-discord"></i>
            </a>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM elements
            const timetableGrid = document.getElementById('timetable-grid');
            const mobileDayView = document.getElementById('mobile-day-view');
            const dayTabs = document.getElementById('day-tabs');
            const searchInput = document.getElementById('search');
            const todayBtn = document.getElementById('today-btn');
            const prevDayBtn = document.getElementById('prev-day');
            const nextDayBtn = document.getElementById('next-day');
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            const modal = document.getElementById('modal');
            const closeModal = document.querySelector('.close-modal');
            const installContainer = document.getElementById('installContainer');
            const installButton = document.getElementById('installButton');
            const dismissInstallButton = document.getElementById('dismissInstallButton');
            const themeOptions = document.querySelectorAll('.theme-option');
            const shareBtn = document.getElementById('share-btn');
            const notifyBtn = document.getElementById('notify-btn');
            const loadingScreen = document.getElementById('loading-screen');

            // Timetable data
            let timetableData = [];
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            let currentDayIndex = 0;
            let deferredPrompt;
            let highlightInterval;

            // Course details from the PDF
            let courseDetails = {
                '1001': {
                    code: '1001',
                    name: 'COMMUNICATION SKILLS IN ENGLISH',
                    faculty: 'SURYA S',
                    type: 'Lecture',
                    credits: '4',
                    hours: '4',
                    dept: 'AS',
                    facultyCode: 'SS'
                },
                '1002': {
                    code: '1002',
                    name: 'MATHEMATICS I',
                    faculty: 'RESMI R NAIR',
                    type: 'Lecture',
                    credits: '5',
                    hours: '5',
                    dept: 'AS',
                    facultyCode: 'RRN'
                },
                '1003': {
                    code: '1003',
                    name: 'APPLIED PHYSICS I',
                    faculty: 'BINCY ANNIE PHILIP',
                    type: 'Lecture',
                    credits: '3',
                    hours: '3',
                    dept: 'AS',
                    facultyCode: 'BAP'
                },
                '1004': {
                    code: '1004',
                    name: 'APPLIED CHEMISTRY',
                    faculty: 'SREEUSHA N',
                    type: 'Lecture',
                    credits: '3',
                    hours: '3',
                    dept: 'AS',
                    facultyCode: 'SN'
                },
                '1005': {
                    code: '1005',
                    name: 'ENGINEERING GRAPHICS',
                    faculty: 'SAMSON PETER',
                    type: 'Practical',
                    credits: '3',
                    hours: '3',
                    dept: 'AS',
                    facultyCode: 'SP'
                },
                '2006': {
                    code: '2006',
                    name: 'APPLIED PHYSICS LAB',
                    faculty: 'BINCY ANNIE PHILIP',
                    type: 'Lab',
                    credits: '2',
                    hours: '2',
                    dept: 'AS',
                    facultyCode: 'BAP'
                },
                '1007': {
                    code: '1007',
                    name: 'APPLIED CHEMISTRY LAB',
                    faculty: 'SREEUSHA N',
                    type: 'Lab',
                    credits: '2',
                    hours: '2',
                    dept: 'AS',
                    facultyCode: 'SN'
                },
                '1008': {
                    code: '1008',
                    name: 'INTRODUCTION TO IT SYSTEM LAB',
                    faculty: 'SHERIN ANNIE THOMAS / DEEPIKA S NAIR',
                    type: 'Lab/Lecture',
                    credits: '3',
                    hours: '3',
                    dept: 'CSE',
                    facultyCode: 'SAT/DSN'
                },
                '2009': {
                    code: '2009',
                    name: 'ENGINEERING WORKSHOP PRACTICE',
                    faculty: 'BINJU K BABU',
                    type: 'Workshop',
                    credits: '3',
                    hours: '3',
                    dept: 'CE,AS',
                    facultyCode: 'BKB'
                },
                '1009': {
                    code: '1009',
                    name: 'SPORTS AND YOGA',
                    faculty: 'RAHUL U',
                    type: 'Practical',
                    credits: '2',
                    hours: '3',
                    dept: 'AS',
                    facultyCode: 'RU'
                }
            };

            // Updated timetable structure with the requested changes
            const timetableStructure = [
                // Morning sessions
                {
                    time: "9:00â€“10:00",
                    monday: "1001 (SS)",
                    tuesday: "1008 (SAT)",
                    wednesday: "2009 (BKB)",
                    thursday: "1004 (SN)",
                    friday: "1005 (SP)"
                },
                {
                    time: "10:00â€“10:10",
                    monday: "**Break**",
                    tuesday: "**Break**",
                    wednesday: "**Break**",
                    thursday: "**Break**",
                    friday: "**Break**"
                },
                {
                    time: "10:10â€“11:10",
                    monday: "1002 (RRN)",
                    tuesday: "1008/2006 (SAT,DSN/BAP)",
                    wednesday: "2009 (BKB)",
                    thursday: "1008/2006 (SAT,DSN/BAP)",
                    friday: "1005/2006 (SP)"
                },
                {
                    time: "11:10â€“12:10",
                    monday: "1003 (BAP)",
                    tuesday: "1001 (SS)",
                    wednesday: "2009 (BKB)",
                    thursday: "",
                    friday: ""
                },
                {
                    time: "12:10â€“12:50",
                    monday: "**Lunch Break**",
                    tuesday: "**Lunch Break**",
                    wednesday: "**Lunch Break**",
                    thursday: "**Lunch Break**",
                    friday: "**Lunch Break**"
                },
                // Afternoon sessions
                {
                    time: "12:50â€“1:50",
                    monday: "1002 (RRN)",
                    tuesday: "1004 (SN)",
                    wednesday: "1002 (RRN)",
                    thursday: "1003 (BAP)",
                    friday: "1001 (SS)"
                },
                {
                    time: "1:50â€“2:50",
                    monday: "1001 (SS)",
                    tuesday: "1001 (SS)",
                    wednesday: "1003 (BAP)",
                    thursday: "",
                    friday: "1002 (RRN)"
                },
                {
                    time: "2:50â€“3:00",
                    monday: "**Break**",
                    tuesday: "**Break**",
                    wednesday: "**Break**",
                    thursday: "1007 (SN)",
                    friday: ""
                },
                {
                    time: "3:00â€“4:00",
                    monday: "1003 (BAP)",
                    tuesday: "1002 (RRN)",
                    wednesday: "1009 (RU)",
                    thursday: "",
                    friday: "1004 (SN)"
                }
            ];

            // --- Feature: Web Share API ---
            shareBtn.addEventListener('click', async () => {
                const shareData = {
                    title: 'College Timetable',
                    text: 'Check out my college timetable!',
                    url: window.location.href
                };
                if (navigator.share) {
                    try {
                        await navigator.share(shareData);
                        console.log('Timetable shared successfully!');
                    } catch (err) {
                        console.error('Error sharing:', err);
                        // Fallback if share fails (optional)
                        // e.g., copy link to clipboard or show share options
                    }
                } else {
                    alert('Web Share API not supported in your browser. You can manually share the link: ' + window.location.href);
                    // Fallback if Web Share API is not supported
                    // e.g., copy link to clipboard
                    try {
                        await navigator.clipboard.writeText(window.location.href);
                        alert('Link copied to clipboard!');
                    } catch (err) {
                        console.error('Could not copy text: ', err);
                    }
                }
            });

            // --- Feature: Notifications ---
            notifyBtn.addEventListener('click', requestNotificationPermission);
            function requestNotificationPermission() {
                if (!("Notification" in window)) {
                    alert("This browser does not support desktop notification");
                    notifyBtn.disabled = true;
                    return;
                }
                if (Notification.permission === "granted") {
                    alert("Notifications already enabled!");
                    notifyBtn.disabled = true; // Disable button if already granted
                    return;
                }
                if (Notification.permission !== "denied") {
                    Notification.requestPermission().then(permission => {
                        if (permission === "granted") {
                            alert("Notifications enabled!");
                            notifyBtn.disabled = true; // Disable button after granting
                            // Optionally, show a test notification
                            // showNotification("Test", "Notifications are working!");
                        } else {
                            alert("Notifications denied.");
                            notifyBtn.disabled = false; // Keep enabled if denied
                        }
                    });
                } else {
                    alert("Notifications have been denied. Please enable them in your browser settings.");
                    notifyBtn.disabled = true; // Disable if permanently denied
                }
            }
            // Function to show a notification (call this when needed, e.g., for upcoming classes)
            function showNotification(title, body) {
                if (Notification.permission === "granted") {
                    new Notification(title, { body: body, icon: '/icons/icon-192x192.png' });
                }
            }

            // --- Initialize the timetable ---
            function initializeTimetable() {
                // --- Feature: Timetable Data Persistence ---
                // Load timetable from localStorage or use default
                const storedTimetable = localStorage.getItem('timetableData');
                if (storedTimetable) {
                    try {
                        timetableData = JSON.parse(storedTimetable);
                        console.log("Timetable loaded from localStorage.");
                    } catch (e) {
                        console.error("Error parsing timetable from localStorage, using default.", e);
                        timetableData = timetableStructure;
                    }
                } else {
                    timetableData = timetableStructure;
                    // Save default timetable to localStorage for offline use
                    localStorage.setItem('timetableData', JSON.stringify(timetableData));
                    console.log("Default timetable saved to localStorage.");
                }

                // --- Feature: Course Details Persistence ---
                // Load course details from localStorage or use default
                const storedCourseDetails = localStorage.getItem('courseDetails');
                if (storedCourseDetails) {
                    try {
                        courseDetails = JSON.parse(storedCourseDetails); // Update the global variable
                        console.log("Course details loaded from localStorage.");
                    } catch (e) {
                        console.error("Error parsing course details from localStorage, using default.", e);
                        // Keep the original courseDetails object defined earlier
                    }
                } else {
                    // If localStorage is empty, courseDetails remains as defined initially
                    console.log("Using default course details.");
                }

                createDayTabs();
                renderTimetableGrid();
                renderMobileDayView(currentDayIndex);
                highlightCurrentClass(); // Initial highlight
                startHighlightInterval(); // Start the interval for dynamic highlighting
                // Load last viewed day from localStorage
                const savedDay = localStorage.getItem('lastViewedDay');
                if (savedDay !== null) {
                    const dayIndex = days.indexOf(savedDay);
                    if (dayIndex !== -1) {
                        currentDayIndex = dayIndex;
                        updateActiveTab();
                        renderMobileDayView(currentDayIndex);
                    }
                }
                // Set initial theme
                const savedTheme = localStorage.getItem('theme') || 'light';
                setTheme(savedTheme);
                // Check notification permission status on load
                if (Notification.permission === "granted") {
                    notifyBtn.disabled = true;
                } else if (Notification.permission === "denied") {
                     notifyBtn.disabled = true;
                }
                // --- Hide Loading Screen after a short delay to ensure rendering ---
                setTimeout(() => {
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                         loadingScreen.style.display = 'none';
                    }, 500); // Match the CSS transition duration
                }, 500); // A small delay to ensure content is rendered before hiding
            }

            // --- Feature: Dynamic Highlighting ---
            function startHighlightInterval() {
                // Clear any existing interval to prevent duplicates
                if (highlightInterval) clearInterval(highlightInterval);
                // Run highlightCurrentClass immediately and then every minute
                highlightInterval = setInterval(highlightCurrentClass, 60000); // 60 seconds
            }

            // Create day tabs
            function createDayTabs() {
                dayTabs.innerHTML = '';
                days.forEach((day, index) => {
                    const tab = document.createElement('div');
                    tab.className = 'day-tab';
                    if (index === currentDayIndex) tab.classList.add('active');
                    tab.textContent = day;
                    tab.dataset.dayIndex = index;
                    tab.addEventListener('click', () => {
                        currentDayIndex = index;
                        updateActiveTab();
                        renderMobileDayView(currentDayIndex);
                        localStorage.setItem('lastViewedDay', day);
                    });
                    dayTabs.appendChild(tab);
                });
            }

            // Update active tab
            function updateActiveTab() {
                const tabs = document.querySelectorAll('.day-tab');
                tabs.forEach((tab, index) => {
                    if (index === currentDayIndex) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });
            }

            // Render timetable grid (desktop view)
            function renderTimetableGrid(filter = '') {
                // Clear existing content (except headers)
                while (timetableGrid.children.length > 6) {
                    timetableGrid.removeChild(timetableGrid.lastChild);
                }
                timetableData.forEach(slot => {
                    // Add time column
                    const timeCell = document.createElement('div');
                    timeCell.className = 'time-label';
                    timeCell.textContent = slot.time;
                    timetableGrid.appendChild(timeCell);
                    // Add day columns
                    days.forEach(day => {
                        const dayLower = day.toLowerCase();
                        const content = slot[dayLower] || '';
                        const cell = document.createElement('div');
                        if (content === '') {
                            cell.className = 'time-slot empty';
                            cell.innerHTML = '&nbsp;';
                        } else {
                            const isBreak = content.includes('**Break**');
                            const isLunch = content.includes('**Lunch Break**');
                            const isClass = !isBreak && !isLunch && content.trim() !== '';
                            cell.className = 'time-slot';
                            if (isBreak) {
                                cell.classList.add('break');
                                cell.textContent = content.replace(/\*\*/g, '');
                            } else if (isLunch) {
                                cell.classList.add('lunch');
                                cell.textContent = content.replace(/\*\*/g, '');
                            } else if (isClass) {
                                // Parse course code and faculty code
                                const courseMatch = content.match(/(\d+)\s*\(([^)]+)\)/);
                                if (courseMatch) {
                                    const courseCode = courseMatch[1];
                                    const facultyCode = courseMatch[2];
                                    const course = courseDetails[courseCode] || {};
                                    // Determine class type for styling
                                    if (course.type === 'Lab') {
                                        cell.classList.add('lab');
                                    } else if (course.type === 'Workshop') {
                                        cell.classList.add('workshop');
                                    } else if (courseCode === '1009') {
                                        cell.classList.add('sports');
                                    } else {
                                        cell.classList.add('lecture');
                                    }
                                    cell.innerHTML = `
                                        <div class="time-label">${slot.time}</div>
                                        <div class="course-code">${courseCode} (${facultyCode})</div>
                                        <div class="course-name">${course.name || 'N/A'}</div>
                                        <div class="faculty-info">${course.faculty || 'N/A'}</div>
                                        <div class="credit-hours">${course.credits || 'N/A'} credits â€¢ ${course.hours || 'N/A'} hrs/week</div>
                                    `;
                                    // Add click event for modal
                                    cell.addEventListener('click', () => {
                                        showModal(
                                            courseCode,
                                            course.name || 'N/A',
                                            course.faculty || 'N/A',
                                            day,
                                            slot.time,
                                            course.type || 'N/A',
                                            course.credits || 'N/A',
                                            course.hours || 'N/A',
                                            course.dept || 'N/A',
                                            facultyCode
                                        );
                                    });
                                } else {
                                    cell.textContent = content;
                                }
                            }
                        }
                        // Apply filter
                        if (filter) {
                            const searchText = cell.textContent.toLowerCase();
                            if (!searchText.includes(filter.toLowerCase())) {
                                cell.style.display = 'none';
                            } else {
                                cell.style.display = 'flex';
                            }
                        } else {
                            cell.style.display = 'flex';
                        }
                        timetableGrid.appendChild(cell);
                    });
                });
            }

            // Render mobile day view
            function renderMobileDayView(dayIndex, filter = '') {
                const day = days[dayIndex].toLowerCase();
                mobileDayView.innerHTML = '';
                const dayTitle = document.createElement('h2');
                dayTitle.textContent = days[dayIndex];
                dayTitle.style.textAlign = 'center';
                dayTitle.style.marginBottom = '20px';
                dayTitle.style.color = 'var(--primary-color)';
                mobileDayView.appendChild(dayTitle);
                const dayContent = document.createElement('div');
                dayContent.className = 'day-content';
                mobileDayView.appendChild(dayContent);
                let hasResults = false;
                timetableData.forEach(slot => {
                    const content = slot[day] || '';
                    if (content.trim() === '') return;
                    const card = document.createElement('div');
                    const isBreak = content.includes('**Break**');
                    const isLunch = content.includes('**Lunch Break**');
                    const isClass = !isBreak && !isLunch;
                    card.className = 'time-slot';
                    if (isBreak) {
                        card.classList.add('break');
                        card.textContent = `${slot.time}: ${content.replace(/\*\*/g, '')}`;
                    } else if (isLunch) {
                        card.classList.add('lunch');
                        card.textContent = `${slot.time}: ${content.replace(/\*\*/g, '')}`;
                    } else if (isClass) {
                        // Parse course code and faculty code
                        const courseMatch = content.match(/(\d+)\s*\(([^)]+)\)/);
                        if (courseMatch) {
                            const courseCode = courseMatch[1];
                            const facultyCode = courseMatch[2];
                            const course = courseDetails[courseCode] || {};
                            // Determine class type for styling
                            if (course.type === 'Lab') {
                                card.classList.add('lab');
                            } else if (course.type === 'Workshop') {
                                card.classList.add('workshop');
                            } else if (courseCode === '1009') {
                                card.classList.add('sports');
                            } else {
                                card.classList.add('lecture');
                            }
                            card.innerHTML = `
                                <div class="time-label">${slot.time}</div>
                                <div class="course-code">${courseCode} (${facultyCode})</div>
                                <div class="course-name">${course.name || 'N/A'}</div>
                                <div class="faculty-info">${course.faculty || 'N/A'}</div>
                                <div class="credit-hours">${course.credits || 'N/A'} credits â€¢ ${course.hours || 'N/A'} hrs/week</div>
                            `;
                            // Add click event for modal
                            card.addEventListener('click', () => {
                                showModal(
                                    courseCode,
                                    course.name || 'N/A',
                                    course.faculty || 'N/A',
                                    days[dayIndex],
                                    slot.time,
                                    course.type || 'N/A',
                                    course.credits || 'N/A',
                                    course.hours || 'N/A',
                                    course.dept || 'N/A',
                                    facultyCode
                                );
                            });
                        } else {
                            card.textContent = content;
                        }
                    }
                    // Apply filter
                    if (filter) {
                        const searchText = card.textContent.toLowerCase();
                        if (!searchText.includes(filter.toLowerCase())) {
                            return;
                        }
                    }
                    dayContent.appendChild(card);
                    hasResults = true;
                });
                if (!hasResults) {
                    const noResults = document.createElement('div');
                    noResults.className = 'no-results';
                    noResults.textContent = 'No classes found for this day';
                    dayContent.appendChild(noResults);
                }
            }

            // Highlight current ongoing class
            function highlightCurrentClass() {
                // Remove previous highlights
                document.querySelectorAll('.time-slot.current').forEach(el => el.classList.remove('current'));
                const now = new Date();
                const currentHour = now.getHours();
                const currentMinute = now.getMinutes();
                const currentDay = now.getDay(); // 0 = Sunday, 1 = Monday, etc.
                // Only highlight if it's a weekday (Monday to Friday)
                if (currentDay >= 1 && currentDay <= 5) {
                    const dayIndex = currentDay - 1;
                    const day = days[dayIndex].toLowerCase();
                    timetableData.forEach(slot => {
                        const timeMatch = slot.time.match(/(\d+):(\d+)â€“(\d+):(\d+)/);
                        if (!timeMatch) return;
                        const startHour = parseInt(timeMatch[1]);
                        const startMinute = parseInt(timeMatch[2]);
                        const endHour = parseInt(timeMatch[3]);
                        const endMinute = parseInt(timeMatch[4]);
                        const slotStart = new Date();
                        slotStart.setHours(startHour, startMinute, 0, 0);
                        const slotEnd = new Date();
                        slotEnd.setHours(endHour, endMinute, 0, 0);
                        if (now >= slotStart && now <= slotEnd) {
                            // Highlight in grid view
                            const timeIndex = timetableData.indexOf(slot);
                            if (timeIndex !== -1) {
                                const cellIndex = 1 + dayIndex + (timeIndex * 6);
                                const cell = timetableGrid.children[cellIndex];
                                if (cell) {
                                    cell.classList.add('current');
                                    // --- Feature: Trigger Notification ---
                                    // Example: Show notification when class starts (you might want to refine this logic)
                                    // const courseMatch = slot[day].match(/(\d+)\s*\(([^)]+)\)/);
                                    // if (courseMatch) {
                                    //     const courseCode = courseMatch[1];
                                    //     const course = courseDetails[courseCode] || {};
                                    //     showNotification("Class Starting", `${course.name || 'Unknown Class'} is starting now.`);
                                    // }
                                }
                            }
                            // Highlight in mobile view if viewing current day
                            if (currentDayIndex === dayIndex) {
                                const mobileCards = document.querySelectorAll('.mobile-day-view .time-slot');
                                mobileCards.forEach(card => {
                                    if (card.textContent.includes(slot.time)) {
                                        card.classList.add('current');
                                    }
                                });
                            }
                        }
                    });
                }
            }

            // Show modal with class details
            function showModal(code, subject, teacher, day, time, type, credits, hours, dept, facultyCode) {
                document.getElementById('modal-title').textContent = subject;
                document.getElementById('modal-time').textContent = time;
                document.getElementById('modal-day').textContent = day;
                document.getElementById('modal-code').textContent = code;
                document.getElementById('modal-subject').textContent = subject;
                document.getElementById('modal-teacher').textContent = teacher + (facultyCode ? ` (${facultyCode})` : '');
                document.getElementById('modal-type').textContent = type;
                document.getElementById('modal-credits').textContent = credits;
                document.getElementById('modal-hours').textContent = hours;
                document.getElementById('modal-dept').textContent = dept;
            }

            // Close modal
            closeModal.addEventListener('click', () => {
                modal.style.display = 'none';
            });

            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });

            // Search functionality
            searchInput.addEventListener('input', (e) => {
                const filter = e.target.value.trim();
                renderTimetableGrid(filter);
                renderMobileDayView(currentDayIndex, filter);
            });

            // Today button
            todayBtn.addEventListener('click', () => {
                const today = new Date().getDay() - 1; // 0 = Monday
                if (today >= 0 && today <= 4) {
                    currentDayIndex = today;
                    updateActiveTab();
                    renderMobileDayView(currentDayIndex);
                    localStorage.setItem('lastViewedDay', days[currentDayIndex]);
                }
            });

            // Previous day button
            prevDayBtn.addEventListener('click', () => {
                currentDayIndex = (currentDayIndex - 1 + days.length) % days.length;
                updateActiveTab();
                renderMobileDayView(currentDayIndex);
                localStorage.setItem('lastViewedDay', days[currentDayIndex]);
            });

            // Next day button
            nextDayBtn.addEventListener('click', () => {
                currentDayIndex = (currentDayIndex + 1) % days.length;
                updateActiveTab();
                renderMobileDayView(currentDayIndex);
                localStorage.setItem('lastViewedDay', days[currentDayIndex]);
            });

            // Theme toggle
            themeToggle.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
                const newTheme = currentTheme === 'light' ? 'dark' :
                                currentTheme === 'dark' ? 'ocean' : 'light';
                setTheme(newTheme);
                localStorage.setItem('theme', newTheme);
            });

            // Theme options
            themeOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const theme = option.getAttribute('data-theme');
                    setTheme(theme);
                    localStorage.setItem('theme', theme);
                });
            });

            // Set theme
            function setTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                if (theme === 'light') {
                    themeIcon.textContent = 'ðŸŒ™';
                } else if (theme === 'dark') {
                    themeIcon.textContent = 'â˜€ï¸';
                } else {
                    themeIcon.textContent = 'ðŸŒŠ';
                }
            }

            // PWA Installation
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                installContainer.classList.remove('hidden'); // Use classList.remove instead of style.display
            });
            installButton.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    if (outcome === 'accepted') {
                        installContainer.classList.add('hidden'); // Use classList.add
                    }
                    deferredPrompt = null;
                }
            });
            // Dismiss PWA prompt
            dismissInstallButton.addEventListener('click', () => {
                 installContainer.classList.add('hidden'); // Use classList.add
                 // Optionally, store dismissal in localStorage to not show again for a while
                 localStorage.setItem('pwaPromptDismissed', Date.now().toString());
            });
            window.addEventListener('appinstalled', () => {
                installContainer.classList.add('hidden'); // Use classList.add
            });

            // Initialize the timetable
            initializeTimetable();
        });
    </script>
</body>
</html>