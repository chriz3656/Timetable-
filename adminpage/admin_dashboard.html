<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard(BetaS)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6b8cae;
            --text-color: #333;
            --light-text: #f5f5f5;
            --bg-color: #f9f9f9;
            --card-bg: #ffffff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }

        .header-title {
            color: var(--primary-color);
            font-size: 1.8rem;
        }

        .logout-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .logout-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .dashboard-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .dashboard-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .panel h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-danger:hover {
            opacity: 0.9;
        }

        .btn-edit {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .btn-edit:hover {
            opacity: 0.9;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f1f1f1;
            font-weight: 600;
        }

        tr:hover {
            background-color: #f9f9f9;
        }

        .timetable-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .time-slot {
            padding: 10px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            background-color: var(--card-bg);
            border: 1px solid #eee;
            text-align: center;
            font-size: 0.85em;
        }

        .time-slot.time-label {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
        }

        .save-btn {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            margin-top: 20px;
            padding: 12px 20px;
            font-size: 1.1rem;
        }

        .save-btn:hover {
            opacity: 0.9;
        }

        .status-message {
            padding: 10px;
            border-radius: var(--border-radius);
            margin: 10px 0;
            display: none; /* Hidden by default */
        }

        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 class="header-title">Timetable Admin Dashboard(Beta)</h1>
            <button id="logoutBtn" class="logout-btn">Logout</button>
        </header>

        <div id="statusMessage" class="status-message"></div>

        <div class="dashboard-content">
            <!-- Course Management Panel -->
            <div class="panel">
                <h3><i class="fas fa-book"></i> Manage Courses</h3>
                <form id="courseForm">
                    <input type="hidden" id="editCourseId">
                    <div class="form-group">
                        <label for="courseCode">Course Code *</label>
                        <input type="text" id="courseCode" name="courseCode" required>
                    </div>
                    <div class="form-group">
                        <label for="courseName">Course Name *</label>
                        <input type="text" id="courseName" name="courseName" required>
                    </div>
                    <div class="form-group">
                        <label for="faculty">Faculty *</label>
                        <input type="text" id="faculty" name="faculty" required>
                    </div>
                     <div class="form-group">
                        <label for="facultyCode">Faculty Code *</label>
                        <input type="text" id="facultyCode" name="facultyCode" required>
                    </div>
                    <div class="form-group">
                        <label for="type">Type *</label>
                        <select id="type" name="type" required>
                            <option value="Lecture">Lecture</option>
                            <option value="Lab">Lab</option>
                            <option value="Workshop">Workshop</option>
                            <option value="Practical">Practical</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="credits">Credits *</label>
                        <input type="number" id="credits" name="credits" min="1" max="10" required>
                    </div>
                     <div class="form-group">
                        <label for="hours">Hours/Week *</label>
                        <input type="number" id="hours" name="hours" min="1" max="10" required>
                    </div>
                    <div class="form-group">
                        <label for="dept">Department *</label>
                        <input type="text" id="dept" name="dept" required>
                    </div>
                    <button type="submit" class="btn btn-primary" id="submitCourseBtn">Add Course</button>
                    <button type="button" class="btn btn-primary" id="updateCourseBtn" style="display:none;">Update Course</button>
                    <button type="button" class="btn btn-danger" id="cancelEditCourseBtn" style="display:none;">Cancel</button>
                </form>

                <h4 style="margin-top: 20px;">Current Courses</h4>
                <table id="coursesTable">
                    <thead>
                        <tr>
                            <th>Code</th>
                            <th>Name</th>
                            <th>Faculty</th>
                            <th>Type</th>
                            <th>Credits</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="coursesTableBody">
                        <!-- Rows will be populated by JS -->
                    </tbody>
                </table>
            </div>

            <!-- Timetable Management Panel -->
            <div class="panel">
                <h3><i class="fas fa-table"></i> Manage Timetable Slots</h3>
                <form id="timetableForm">
                    <input type="hidden" id="editSlotId">
                    <div class="form-group">
                        <label for="slotTime">Time Slot *</label>
                        <input type="text" id="slotTime" name="slotTime" placeholder="e.g., 9:00â€“10:00" required>
                    </div>
                    <div class="form-group">
                        <label for="slotMonday">Monday (CourseCode (FacCode) or Break/Lunch)</label>
                        <input type="text" id="slotMonday" name="slotMonday" placeholder="e.g., 1001 (SS) or **Break**">
                    </div>
                    <div class="form-group">
                        <label for="slotTuesday">Tuesday</label>
                        <input type="text" id="slotTuesday" name="slotTuesday" placeholder="e.g., 1008 (SAT)">
                    </div>
                    <div class="form-group">
                        <label for="slotWednesday">Wednesday</label>
                        <input type="text" id="slotWednesday" name="slotWednesday" placeholder="e.g., 2009 (BKB)">
                    </div>
                    <div class="form-group">
                        <label for="slotThursday">Thursday</label>
                        <input type="text" id="slotThursday" name="slotThursday" placeholder="e.g., 1004 (SN)">
                    </div>
                    <div class="form-group">
                        <label for="slotFriday">Friday</label>
                        <input type="text" id="slotFriday" name="slotFriday" placeholder="e.g., 1005 (SP)">
                    </div>
                    <button type="submit" class="btn btn-primary" id="submitSlotBtn">Add Slot</button>
                    <button type="button" class="btn btn-primary" id="updateSlotBtn" style="display:none;">Update Slot</button>
                    <button type="button" class="btn btn-danger" id="cancelEditSlotBtn" style="display:none;">Cancel</button>
                </form>

                <h4 style="margin-top: 20px;">Current Timetable Structure</h4>
                <div class="timetable-grid" id="timetableGridPreview">
                    <!-- Grid will be populated by JS -->
                </div>
                <button id="saveDataBtn" class="btn save-btn"><i class="fas fa-save"></i> Save All Changes to App</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if admin is logged in
            if (!localStorage.getItem('adminLoggedIn')) {
                alert('Please log in first.');
                window.location.href = './admin_login.html';
                return;
            }

            // DOM Elements
            const logoutBtn = document.getElementById('logoutBtn');
            const courseForm = document.getElementById('courseForm');
            const timetableForm = document.getElementById('timetableForm');
            const coursesTableBody = document.getElementById('coursesTableBody');
            const timetableGridPreview = document.getElementById('timetableGridPreview');
            const submitCourseBtn = document.getElementById('submitCourseBtn');
            const updateCourseBtn = document.getElementById('updateCourseBtn');
            const cancelEditCourseBtn = document.getElementById('cancelEditCourseBtn');
            const submitSlotBtn = document.getElementById('submitSlotBtn');
            const updateSlotBtn = document.getElementById('updateSlotBtn');
            const cancelEditSlotBtn = document.getElementById('cancelEditSlotBtn');
            const saveDataBtn = document.getElementById('saveDataBtn');
            const statusMessage = document.getElementById('statusMessage');

            // --- Data Management ---
            let courseDetails = JSON.parse(localStorage.getItem('courseDetails')) || {};
            let timetableData = JSON.parse(localStorage.getItem('timetableData')) || [];

            // --- Functions ---
            function showMessage(message, isError = false) {
                statusMessage.textContent = message;
                statusMessage.className = 'status-message ' + (isError ? 'status-error' : 'status-success');
                statusMessage.style.display = 'block';
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 5000); // Hide after 5 seconds
            }

            function populateCoursesTable() {
                coursesTableBody.innerHTML = '';
                for (const [code, details] of Object.entries(courseDetails)) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${details.code}</td>
                        <td>${details.name}</td>
                        <td>${details.faculty}</td>
                        <td>${details.type}</td>
                        <td>${details.credits}</td>
                        <td>
                            <button class="btn btn-edit edit-course-btn" data-code="${code}"><i class="fas fa-edit"></i> Edit</button>
                            <button class="btn btn-danger delete-course-btn" data-code="${code}"><i class="fas fa-trash"></i> Delete</button>
                        </td>
                    `;
                    coursesTableBody.appendChild(row);
                }
                // Add event listeners for edit/delete buttons
                document.querySelectorAll('.edit-course-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const code = e.target.closest('.edit-course-btn').getAttribute('data-code');
                        editCourse(code);
                    });
                });
                document.querySelectorAll('.delete-course-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const code = e.target.closest('.delete-course-btn').getAttribute('data-code');
                        deleteCourse(code);
                    });
                });
            }

            function populateTimetableGrid() {
                timetableGridPreview.innerHTML = '';
                // Add header row
                const headerRow = ['Time', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
                headerRow.forEach(header => {
                    const headerDiv = document.createElement('div');
                    headerDiv.className = 'time-slot time-label';
                    headerDiv.textContent = header;
                    timetableGridPreview.appendChild(headerDiv);
                });

                // Add data rows
                timetableData.forEach((slot, index) => {
                    const timeDiv = document.createElement('div');
                    timeDiv.className = 'time-slot time-label';
                    timeDiv.textContent = slot.time;
                    timetableGridPreview.appendChild(timeDiv);

                    ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'].forEach(day => {
                        const dayDiv = document.createElement('div');
                        dayDiv.className = 'time-slot';
                        dayDiv.textContent = slot[day] || '';
                        timetableGridPreview.appendChild(dayDiv);
                    });
                });
            }

            function resetCourseForm() {
                courseForm.reset();
                document.getElementById('editCourseId').value = '';
                submitCourseBtn.style.display = 'inline-block';
                updateCourseBtn.style.display = 'none';
                cancelEditCourseBtn.style.display = 'none';
            }

            function resetTimetableForm() {
                timetableForm.reset();
                document.getElementById('editSlotId').value = '';
                submitSlotBtn.style.display = 'inline-block';
                updateSlotBtn.style.display = 'none';
                cancelEditSlotBtn.style.display = 'none';
            }

            function editCourse(code) {
                const details = courseDetails[code];
                if (details) {
                    document.getElementById('editCourseId').value = code;
                    document.getElementById('courseCode').value = details.code;
                    document.getElementById('courseName').value = details.name;
                    document.getElementById('faculty').value = details.faculty;
                    document.getElementById('facultyCode').value = details.facultyCode;
                    document.getElementById('type').value = details.type;
                    document.getElementById('credits').value = details.credits;
                    document.getElementById('hours').value = details.hours;
                    document.getElementById('dept').value = details.dept;

                    submitCourseBtn.style.display = 'none';
                    updateCourseBtn.style.display = 'inline-block';
                    cancelEditCourseBtn.style.display = 'inline-block';
                }
            }

            function deleteCourse(code) {
                if (confirm(`Are you sure you want to delete course ${code}?`)) {
                    delete courseDetails[code];
                    // Also remove references from timetableData
                    timetableData = timetableData.map(slot => {
                        for (const day of ['monday', 'tuesday', 'wednesday', 'thursday', 'friday']) {
                            if (slot[day] && slot[day].includes(code)) {
                                slot[day] = ''; // Clear the slot if it contains the deleted course
                            }
                        }
                        return slot;
                    });
                    saveDataToStorage();
                    populateCoursesTable();
                    populateTimetableGrid(); // Update grid preview
                    showMessage(`Course ${code} deleted successfully.`);
                }
            }

            function editSlot(index) {
                 const slot = timetableData[index];
                 if (slot) {
                    document.getElementById('editSlotId').value = index; // Store array index
                    document.getElementById('slotTime').value = slot.time;
                    document.getElementById('slotMonday').value = slot.monday || '';
                    document.getElementById('slotTuesday').value = slot.tuesday || '';
                    document.getElementById('slotWednesday').value = slot.wednesday || '';
                    document.getElementById('slotThursday').value = slot.thursday || '';
                    document.getElementById('slotFriday').value = slot.friday || '';

                    submitSlotBtn.style.display = 'none';
                    updateSlotBtn.style.display = 'inline-block';
                    cancelEditSlotBtn.style.display = 'inline-block';
                 }
            }

             function deleteSlot(index) {
                if (confirm(`Are you sure you want to delete the slot "${timetableData[index].time}"?`)) {
                    timetableData.splice(index, 1); // Remove the slot from the array
                    saveDataToStorage();
                    populateTimetableGrid(); // Update grid preview
                    showMessage(`Timetable slot "${timetableData[index]?.time || 'N/A'}" deleted successfully.`);
                }
            }

            function saveDataToStorage() {
                localStorage.setItem('courseDetails', JSON.stringify(courseDetails));
                localStorage.setItem('timetableData', JSON.stringify(timetableData));
            }

            // --- Event Listeners ---
            logoutBtn.addEventListener('click', () => {
                localStorage.removeItem('adminLoggedIn');
                window.location.href = './admin_login.html';
            });

            courseForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const isEditing = document.getElementById('editCourseId').value;
                const code = document.getElementById('courseCode').value.trim();
                const name = document.getElementById('courseName').value.trim();
                const faculty = document.getElementById('faculty').value.trim();
                const facultyCode = document.getElementById('facultyCode').value.trim();
                const type = document.getElementById('type').value;
                const credits = document.getElementById('credits').value;
                const hours = document.getElementById('hours').value;
                const dept = document.getElementById('dept').value.trim();

                if (!code || !name || !faculty || !facultyCode || !type || !credits || !hours || !dept) {
                    showMessage('Please fill in all required fields.', true);
                    return;
                }

                const newCourse = {
                    code: code,
                    name: name,
                    faculty: faculty,
                    facultyCode: facultyCode,
                    type: type,
                    credits: credits,
                    hours: hours,
                    dept: dept
                };

                if (isEditing) {
                    // Update existing course
                    courseDetails[code] = newCourse; // Use the new code as key, potentially changing the key
                    if (code !== isEditing) {
                        delete courseDetails[isEditing]; // Delete old key if it changed
                    }
                    showMessage(`Course ${code} updated successfully.`);
                } else {
                    // Add new course
                    if (courseDetails[code]) {
                        showMessage(`Course with code ${code} already exists.`, true);
                        return;
                    }
                    courseDetails[code] = newCourse;
                    showMessage(`Course ${code} added successfully.`);
                }

                saveDataToStorage();
                populateCoursesTable();
                resetCourseForm();
            });

            timetableForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const isEditing = document.getElementById('editSlotId').value; // This will be the array index if editing
                const time = document.getElementById('slotTime').value.trim();
                const monday = document.getElementById('slotMonday').value.trim();
                const tuesday = document.getElementById('slotTuesday').value.trim();
                const wednesday = document.getElementById('slotWednesday').value.trim();
                const thursday = document.getElementById('slotThursday').value.trim();
                const friday = document.getElementById('slotFriday').value.trim();

                if (!time) {
                    showMessage('Time slot is required.', true);
                    return;
                }

                const newSlot = {
                    time: time,
                    monday: monday,
                    tuesday: tuesday,
                    wednesday: wednesday,
                    thursday: thursday,
                    friday: friday
                };

                if (isEditing !== '') {
                    // Update existing slot
                    const index = parseInt(isEditing);
                    if (index >= 0 && index < timetableData.length) {
                        timetableData[index] = newSlot;
                        showMessage(`Timetable slot "${time}" updated successfully.`);
                    }
                } else {
                    // Add new slot
                    timetableData.push(newSlot);
                    showMessage(`Timetable slot "${time}" added successfully.`);
                }

                saveDataToStorage();
                populateTimetableGrid(); // Update grid preview
                resetTimetableForm();
            });

            cancelEditCourseBtn.addEventListener('click', resetCourseForm);
            cancelEditSlotBtn.addEventListener('click', resetTimetableForm);

            saveDataBtn.addEventListener('click', () => {
                // This button saves the data stored in localStorage to the main app.
                // The main index.html already reads from localStorage on load.
                // So, saving here ensures the next time index.html loads, it gets the new data.
                saveDataToStorage();
                showMessage('Changes saved successfully! They will be reflected in the main timetable app on its next load.');
            });

            // --- Initialize ---
            populateCoursesTable();
            populateTimetableGrid();
        });
    </script>
</body>
</html>